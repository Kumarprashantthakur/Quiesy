{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - QuizApp</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header Section -->
        <header class="dashboard-header">
            <div class="user-info">
                <h1 class="user-email">{{request.user.email}}</h1>
                <h2 class="user-welcome">Welcome, {{ request.user.name }}</h2>
            </div>
            <nav class="dashboard-nav">
                <a href="{% url 'quizcreate' %}" class="nav-btn create-btn">Create Quiz</a>
                <a href="{% url 'teacher_logout_confirm' %}" class="nav-btn logout-btn">Logout</a>
                <a href="{% url 'attendance_dashboard' %}" class="nav-btn">
    Attendance
</a>

            </nav>
        </header>

        <!-- Messages Section -->
        {% if messages %}
        <div id="popup-message" class="message-container">
            {% for message in messages %}
            <div class="alert-message">
                {{ message }}
                <span class="close-btn">&times;</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Main Content -->
        <main class="dashboard-main">
            <h2 class="section-title">Your Quizzes</h2>
            
            {% if quizzes %}
            <div class="quizzes-container">
                {% for quiz in quizzes %}
                <div class="quiz-card">
                    <div class="quiz-header">
                        <h3 class="quiz-title">{{ quiz.title }}</h3>
                        <div class="quiz-subject">
                            <span class="subject-badge">{{ quiz.subject }}</span>
                            <span class="questions-count">{{ quiz.questions.count }} / {{ quiz.num_of_qus }} Questions</span>
                        </div>
                    </div>
                    
                    <div class="quiz-actions">
                        <a href="{% url 'add_questions' quiz.id %}" class="action-btn add-questions-btn">Add Questions</a>
                        <a href="{% url 'delete_quiz' quiz.id %}" class="action-btn delete-btn">Delete Quiz</a>
                    </div>
                    
                    <div class="quiz-share">
                        <p id="quiz-link-{{ quiz.id }}" class="quiz-link">http://127.0.0.1:8000/student/{{quiz.quiz_code}}/start/</p>
                        <button onclick="copyLink({{ quiz.id }})" class="copy-btn">Copy Link</button>
                    </div>
                     <div class="quiz-actions">
                           <span class="quiz-actions">Password : {{ quiz.password }}</span>
                    </div>
                    
                    <div class="quiz-results">
                        <p>View results: <a href="{% url 'student_result' quiz.id %}" class="results-link">See Student Results</a></p>
                    </div>
                    
                    <div class="quiz-settings">
                        <form method="post" class="toggle-form">
                            {% csrf_token %}
                            <input type="hidden" name="quiz_id" value="{{ quiz.id }}">
                            <label class="toggle-label">
                                <input type="checkbox" name="review_on" onchange="this.form.submit()" {% if quiz.review_on %} checked {% endif %}>
                                <span class="toggle-slider"></span>
                                Enable Review
                            </label>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <p>No quizzes created yet.</p>
                <a href="{% url 'quizcreate' %}" class="create-first-btn">Create Your First Quiz</a>
            </div>
            {% endif %}
        </main>
    </div>

    <script>
        // Automatically hide messages after 3 seconds
        setTimeout(function() {
            let msg = document.getElementById('popup-message');
            if (msg) {
                msg.style.display = 'none';
            }
        }, 3000);

        // Close message manually
        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                this.parentElement.style.display = 'none';
            });
        });

        function copyLink(quizId) {
            let linkText = document.getElementById("quiz-link-"+ quizId).innerText;
            navigator.clipboard.writeText(linkText).then(() => {
                // Create a temporary notification
                const notification = document.createElement('div');
                notification.className = 'copy-notification';
                notification.textContent = 'Link copied to clipboard!';
                document.body.appendChild(notification);
                
                // Remove notification after 2 seconds
                setTimeout(() => {
                    notification.remove();
                }, 2000);
            });
        }
    </script>
</body>
</html>